# 分野 2: 構成管理および Infrastructure as Code  
   * 2.1 展開ニーズに基づいて展開サービスを決める。  
   * 2.2 業務ニーズに基づいて、アプリケーションとインフラストラクチャの展開モデルを決める。  
   * 2.3 リソースプロビジョニングの自動化においてセキュリティ概念を適用する。  
   * 2.4 展開にライフサイクルフックを実装する方法を決める。  
   * 2.5 AWS の構成管理ツールおよび構成管理サービスを使用してシステムを管理するために必要な、概念を適用する。  

## サンプル問題の第5問
DevOpsのエンジニアがAWS Lambda関数を作成し、それをAWS CloudFormationテンプレートスニペット（下記参照）で定義し、それをAmazon S3バケットに格納しました。  

```rb
MyLambdaFunctionV1:
  Type: “AWS::Lambda::Function”
    Properties:
      Handler: “index.handler”
      Role: “arn:aws:iam::515290864834:role/AccountScanner”
      Code:
        S3Bucket: “johndoe-com-lambda-source”
        S3Key: “AccountScanner.zip”
    Runtime: “dotnetcore2.1”
    Timeout: 60
```
CloudFormationスタックが作成され、Lambda関数は予想通りに機能しています。 
エンジニアは新しいバージョンの関数コードを入手したので、スタックの更新直後にこの新しいバージョンが実行されるようにしたいと考えています。  
どのデプロイ手順でこれを達成できますか？（3つ選択）  

 * A. CloudFormationテンプレートのLambda関数の論理名をMyLambdaFunctionV1からMyLambdaFunctionV2に更新してから、CloudFormationスタックの更新を実行します。  
 * B. 既存のS3バケットでバージョン管理を有効にします。新しいコードを既存のS3バケットにアップロードします。CloudFormationテンプレートのLambda関数のS3ObjectVersionプロパティでS3オブジェクトのバージョンIDを指定してから、CloudFormationスタックの更新を実行します。  
 * C. AWS SAMを使用して、CloudFormationテンプレートにsam deployコマンドを発行して、Lambda関数のバージョンアップデートを実行します。  
 * D. CloudFormationテンプレートのLambda関数のS3バケットプロパティを更新して、別のバケットの場所を指すようにします。新しいコードを新しいS3バケットの場所にアップロードしてから、CloudFormationスタックの更新を実行します。  
 * E. CloudFormationテンプレートのLambda関数のS3Keyプロパティを更新して、.zipファイルの場所と名前を変更します。.zipファイルの場所と名前の変更に注意して新しいコードをS3バケットにアップロードしてから、CloudFormationスタックの更新を実行します。  
 * F. サーバーレスフレームワークを使用して、 “serverless deploy function -f MyLambdaFunctionV1“コマンドを発行して既存のLambda機能を更新します。  

解説：
この問題では、CloudFormation で既存スタックを更新する場合の知識が問われています。
CloudFormation でスタックを更新する場合は、何らかの方法でテンプレートのコードが前回と変わっている必要性がありますので、
元のコードから変更が発生する選択肢が正解ということになります。
A は、そもそも既存のLambda 関数の更新ですので、論理名を変更してはいけません。これは間違いです。
B は、S3 のバージョニングを有効化しますので、新しい関数のデプロイコードにはバージョンID の指定を追加します。
前回コードと内容が変わりますので正解となります。
C は、AWS SAM を利用するという点ですが、今回のテンプレートはSAM 形式ではありません。SAM はCloudFormation の拡張フォーマットになりますのでSAM に対応するには大幅な変更が必要となります。よって、C は選択肢とはなりません。
D はS3 バケット名やキーが元のコードから変わりますので正解です。
E はコードのKey 部分が変わりますので正解です。
F はCと同様です。
よって、この問題の正解は、B、D、E となります。

## サンプル問題の第6問

DevOpsのエンジニアが、企業のセキュリティコンプライアンスを自動化するよう依頼されました。  
同社は、準拠していないセキュリティ設定を検出するためのカスタムAWS Configルールを開発しました。コンプライアンスの問題が検出された場合、会社は問題を自動的に修正し、セキュリティチームに内部のセキュリティメッセージチャネルを通じて通知することを望んでいます。メッセージボードには、HTTPS POSTリクエストの本文をチャネル経由で発行するRESTインターフェイスがあります。  
費用対効果の最も高い方法で、どの組み合わせのステップでこれらの要件を満たすことができますか？ （3つ選択）

 * A. 設定項目の変更通知をAmazon SNSトピックに発行するAmazon CloudWatchイベントルールを作成します。
 * B. コンプライアンスの変更通知をAmazon SNSトピックに発行するAmazon CloudWatchイベントルールを作成します。
 * C. 設定項目の変更通知をAmazon SNSトピックに発行するようにAWS Configを設定します。
 * D.  AWS ConfigとAWSを統合したAmazon API Gateway RESTful APIを作成します。 APIをAmazon SNSトピックにサブスクライブします。
 * E. メッセージチャネルのHTTPSエンドポイントをAmazon SNSトピックにサブスクライブします。
 * F. 準拠していないセキュリティ設定に対処するAWS Lambda関数を作成します。Amazon SNSトピックに関数を登録します。

 【解説】  
難しい。最初、何を質問されているのか分からないレベルの問題。
AWS Configでシステム構成が変更されたら検知できることは知っているが、それを検知→自動修正→通知する仕組みを問われている。
1つ目は、設定を自動的に修正すること。2つ目は、セキュリティチームに通知することです。また既存のメッセージチャネルにはREST のインターフェイスがあります。  
今回検出するのは、Config ルールによりコンプライアンスに準拠していないことですので、設定の変更そのものを検出するAとCは除外です。  
B のコンプライアンスの変更を検出するのは正しい  
API Gateway を利用してRESTful API を作成する必要はないので、Dは×  
E の既存のメッセージチャネルHTTPS エンドポイントをSNS トピックにサブスクライブするというのは正しい選択です。
最後F を見てみると、問題文には「問題を自動的に修正する」というものもありますので、Lambda により対応できます。よってE も正しい選択肢です。正解は、B、E、F となります。
 